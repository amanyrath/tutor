# AI Insights Dashboard

## Overview

The AI Insights Dashboard displays pattern discoveries identified by AI analysis of tutor engagement data. It helps identify trends, correlations, and actionable recommendations to improve tutor performance and retention.

## Features

### 1. Pattern Discovery
- AI-powered analysis of tutor engagement patterns
- Multiple pattern types:
  - `engagement_increase`: Positive trends in tutor engagement
  - `engagement_decrease`: Declining engagement patterns
  - `quality_improvement`: Quality score improvements
  - `churn_risk`: Patterns indicating potential tutor attrition

### 2. Confidence Scoring
- Each insight includes a confidence score (0-1) indicating AI certainty
- Statistical significance metrics
- Correlation matrices showing relationships between metrics

### 3. Filtering & Search
- Filter by pattern type
- Filter by status (active, implemented, archived)
- Filter by minimum confidence threshold
- Full-text search across titles, descriptions, and recommendations

### 4. Affected Tutors Drill-Down
- View all tutors affected by each pattern
- Click through to individual tutor profiles
- Collapsible tutor ID badges for easy navigation

### 5. AI Recommendations
- Actionable recommendations generated by Claude AI
- Expected impact assessment
- Clear next steps for implementation

### 6. Action Tracking
- Mark insights as "Implemented"
- Archive outdated or irrelevant insights
- Track what actions were taken and when
- Link to intervention creation

## API Endpoints

### GET /api/insights
Fetch pattern insights with optional filters.

**Query Parameters:**
- `patternType` (string): Filter by pattern type
- `status` (string): Filter by status (active, implemented, archived)
- `minConfidence` (number): Minimum confidence score (0-1)
- `startDate` (ISO date): Filter by discovery date range
- `endDate` (ISO date): Filter by discovery date range
- `limit` (number): Maximum results to return

**Response:**
```json
{
  "insights": [
    {
      "id": "...",
      "patternType": "engagement_increase",
      "title": "Morning Sessions Drive Higher Engagement",
      "description": "...",
      "affectedTutorIds": ["T001", "T002", ...],
      "affectedTutorCount": 8,
      "correlations": {
        "session_time": 0.78,
        "subject_difficulty": 0.45
      },
      "statisticalSignificance": 0.95,
      "confidenceScore": 0.87,
      "aiGeneratedRecommendation": "...",
      "aiModel": "claude-3-5-sonnet-20241022",
      "analyzedPeriodStart": "2024-01-01",
      "analyzedPeriodEnd": "2024-01-15",
      "status": "active",
      "discoveredAt": "2024-01-16"
    }
  ],
  "stats": {
    "total": 5,
    "byType": {
      "engagement_increase": 2,
      "churn_risk": 1,
      "quality_improvement": 2
    },
    "avgConfidence": 0.85,
    "totalAffectedTutors": 45
  }
}
```

### POST /api/insights
Create a new manual insight or update existing one.

**Request Body (Create):**
```json
{
  "patternType": "quality_improvement",
  "title": "...",
  "description": "...",
  "affectedTutorIds": ["T001", "T002"],
  "correlations": {},
  "statisticalSignificance": 0.8,
  "confidenceScore": 0.75,
  "aiGeneratedRecommendation": "...",
  "analyzedPeriodStart": "2024-01-01",
  "analyzedPeriodEnd": "2024-01-15"
}
```

**Request Body (Update):**
```json
{
  "id": "existing-insight-id",
  "status": "implemented",
  "actionTaken": "Rolled out training program",
  "actionTakenAt": "2024-01-20"
}
```

### DELETE /api/insights?id={insightId}
Archive an insight (soft delete).

**Query Parameters:**
- `id` (required): Insight ID to archive

## Pattern Discovery Script

The pattern discovery script runs AI analysis on recent tutor data.

### Run Manually
```bash
npm run discover-patterns
# or
npx tsx scripts/discover-patterns.ts
```

### Automated Execution
Configure in `vercel.json` for scheduled execution:
```json
{
  "crons": [
    {
      "path": "/api/cron/discover-patterns",
      "schedule": "0 6 * * 1"
    }
  ]
}
```

### What It Analyzes
1. Week-over-week metrics comparison
2. Top performing tutors
3. Declining tutors
4. Correlation matrices across metrics:
   - avgEngagement
   - avgRating
   - sessionsCompleted
   - monthsExperience
   - rescheduleRate
   - technicalIssueRate

### Output
- Stores insights in `PatternInsight` table
- Includes AI-generated recommendations
- Calculates confidence and significance scores
- Identifies affected tutors

## Testing

### Create Demo Insights
```bash
npm run demo-insights
```

This creates 5 sample insights for testing the dashboard:
1. Morning Sessions Drive Higher Engagement
2. High Reschedule Rate Predicts Tutor Attrition
3. First Session Success Correlates with Long-Term Performance
4. Technical Issues Lead to Engagement Drop
5. Screen Sharing Increases Student Satisfaction

### Test API Endpoints
```bash
curl http://localhost:3000/api/insights
curl http://localhost:3000/api/insights?patternType=engagement_increase
curl http://localhost:3000/api/insights?minConfidence=0.8
```

## Components

### InsightCard
Displays a single pattern insight with:
- Pattern type badge and icon
- Confidence score
- Description
- AI recommendation
- Affected tutors (expandable)
- Correlations (expandable)
- Action buttons

**Props:**
```typescript
interface InsightCardProps {
  insight: PatternInsight
  onArchive?: (id: string) => void
  onMarkImplemented?: (id: string) => void
}
```

### InsightsPage
Main dashboard page with:
- Stats overview cards
- Pattern distribution
- Filters and search
- Insights list

## Database Schema

```prisma
model PatternInsight {
  id                      String    @id @default(cuid())
  patternType             String
  title                   String
  description             String    @db.Text
  
  affectedTutorIds        Json
  affectedTutorCount      Int
  
  correlations            Json?
  statisticalSignificance Float?
  confidenceScore         Float
  
  aiGeneratedRecommendation String  @db.Text
  aiModel                 String?
  aiPrompt                String?   @db.Text
  
  analyzedPeriodStart     DateTime
  analyzedPeriodEnd       DateTime
  
  status                  String    @default("active")
  actionTaken             String?   @db.Text
  actionTakenAt           DateTime?
  
  discoveredAt            DateTime  @default(now())
}
```

## Best Practices

1. **Run pattern discovery weekly** to catch emerging trends
2. **Act on high-confidence insights** (>80%) promptly
3. **Archive outdated insights** to keep dashboard clean
4. **Mark insights as implemented** when actions are taken
5. **Review correlations** to understand underlying patterns
6. **Track affected tutors** for follow-up interventions

## Integration Points

### With Interventions System
Insights link directly to intervention creation:
```
/dashboard/interventions/new?insight={insightId}
```

### With Tutor Profiles
Click affected tutor IDs to view detailed profiles:
```
/dashboard/tutors/{tutorId}
```

### With Experiments
Use insights to design A/B tests via GrowthBook integration.

## Roadmap

- [ ] Email digests of new insights
- [ ] Insight impact tracking
- [ ] Pattern trend visualization over time
- [ ] Collaborative commenting on insights
- [ ] Custom insight creation workflow
- [ ] Integration with intervention success metrics

## Troubleshooting

### No insights showing up
1. Run `npm run demo-insights` to create sample data
2. Check database connection
3. Verify API endpoint is working: `curl http://localhost:3000/api/insights`

### Pattern discovery fails
1. Check `OPENROUTER_API_KEY` or `ANTHROPIC_API_KEY` is set in `.env`
2. Ensure sufficient tutor data exists
3. Review error logs in console
4. See `docs/openrouter-setup.md` for detailed setup guide

### Filters not working
1. Clear browser cache
2. Check network tab for API errors
3. Verify query parameters are correct

## Support

For issues or questions:
1. Check error logs in browser console
2. Review API response in network tab
3. Verify database schema is up to date
4. Check that AI API key is configured

